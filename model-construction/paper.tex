\documentclass[11pt]{amsart}
\usepackage{setspace,url,hyperref}
\usepackage{amssymb,stmaryrd}
\usepackage{proof}
\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}
\newtheorem{thm}{Theorem}[section]
\newtheorem{prop}[thm]{Proposition}
\newtheorem{lem}[thm]{Lemma}
\newtheorem{cor}[thm]{Corollary}
\theoremstyle{definition}
\newtheorem{definition}[thm]{Definition}
\newtheorem{example}[thm]{Example}
\theoremstyle{remark}
\newtheorem{remark}[thm]{Remark}
\numberwithin{equation}{section}

\def\InputModeColorName{MidnightBlue}
\def\OutputModeColorName{Maroon}
\newcommand\IMode[1]{{\color{\InputModeColorName}{#1}}}
\newcommand\OMode[1]{{\color{\OutputModeColorName}{#1}}}

\newcommand\Sem[1]{\left\llbracket \IMode{#1}\right\rrbracket}
\newcommand\Force[2]{\IMode{#1}\Vdash #2}
\newcommand\IsWorld[2]{\IMode{#1}\ \textit{world}_\IMode{#2}}
\newcommand\Match[2]{\IMode{#1}\equiv\OMode{#2}}
\newcommand\Val[2]{\mathcal{V}_{\IMode{#1}}\Sem{#2}}
\newcommand\IsVal[4]{\Val{#1}{#2}\left(\IMode{#3},\IMode{#4}\right)}
\newcommand\Exp[2]{\mathcal{E}_{\IMode{#1}}\Sem{#2}}
\newcommand\ExpStar[2]{\mathcal{E}_{\IMode{#1}}^\star\Sem{#2}}
\newcommand\IsExp[4]{\Exp{#1}{#2}\left(\IMode{#3},\IMode{#4}\right)}
\newcommand\IsExpStar[4]{\ExpStar{#1}{#2}\left(\IMode{#3},\IMode{#4}\right)}
\newcommand\SetLit[1]{\left\{#1\right\}}
\newcommand\CompLit[2]{\SetLit{#1\mid #2}}
\newcommand\Sig[1]{\mathbf{\Psi}_{#1}}
\newcommand\SigTT{\mathbf{TT}}
\newcommand\TyVoid{\mathsf{void}}
\newcommand\TyUnit{\mathsf{unit}}
\newcommand\TyDFun[3]{(\Pi #2 \in #1)#3}
\newcommand\TyDProd[3]{(\Sigma #2 \in #1)#3}
\newcommand\Ax{\mathsf{Ax}}
\newcommand\PrecEq[2]{\IMode{#1}\preceq\IMode{#2}}
\newcommand\SuccEq[2]{\IMode{#1}\succeq\IMode{#2}}
\newcommand\TyProd[2]{#1\times #2}
\newcommand\Pair[2]{\left\langle #1, #2 \right\rangle}
\newcommand\TyFun[2]{#1\supset #2}
\newcommand\Lam[2]{(\lambda #1)#2}
\newcommand\Ap[2]{\mathsf{ap}(#1; #2)}
\newcommand\Spread[4]{\mathsf{spread}(#1; #2,#3.#4)}
\newcommand\Require[3]{\mathsf{require}(#1; #2.#3)}
\newcommand\Member[2]{\IMode{#1} \in \IMode{#2}}
\newcommand\Eval[3]{\IMode{#2}\Downarrow_{#1}\OMode{#3}}
\newcommand\Worlds{\mathcal{W}}
\newcommand\MkWorld[3]{\left\langle #1, #2, #3\right\rangle}
\newcommand\Pow[1]{\mathbb{P}\left(#1\right)}
\newcommand\List[1]{#1\star}
\newcommand\SETS{\mathbf{Set}}
\newcommand\Ext[1]{\left[#1\right]}
\newcommand\Term[1]{\mathcal{B}_{#1}}
\newcommand\SubsetEq[2]{\IMode{#1}\subseteq\IMode{#2}}
\newcommand\SupsetEq[2]{\IMode{#1}\supseteq\IMode{#2}}
\newcommand\Dom[1]{\mathbf{D}_{#1}}
\newcommand\Types[1]{\mathbf{T}_{#1}}
\newcommand\Witnesses[1]{\mathbf{K}_{#1}}
\newcommand\WitnessesOf[2]{\Witnesses{#1}\left(#2\right)}
\newcommand\OpRequire{\mathsf{require}}

\begin{document}

\title{Oracles and Choice Sequences for Type-Theoretic Pragmatics}

\author{Jonathan Sterling}
\address{}

\maketitle

\section{Model Construction}

We will now ground the intuitive semantics for the extended theory in a
concrete model construction, using Kripke logical relations.  Let $\Term\Psi$
be the set of abstract binding trees (terms) generated by the signature $\Psi$.
Then, we define a world $w$ as a triple
$\MkWorld{\Sig{w}}{\Types{w}}{\Witnesses{w}}$, where $\Types{w}$ is the finite
list of terms which have been recognized as canonical types so far, and
$\WitnessesOf{w}{A}$ is the finite list of witnesses of the truth of $A$ that
have been constructed so far, for each $A$ in $\Types{w}$. In other words, the
set of worlds $\Worlds$ is defined as follows, where for any set $S$, the
functor $\Ext{-} : \List{S}\to\SETS$ takes a list to its extension as a set.
\[
  \Worlds
    \triangleq
     \coprod_{\Psi\in \mathsf{sig}}
      \coprod_{T\in\List{\Term{\Psi}}}
       \Ext{T}\to\List{\Term\Psi}
\]

Let $\Dom{w}$ be the domain of discourse $\Term{\Psi{w}}$. The accessibility
relation $\preceq$ is defined as follows:
\begin{align*}
  \PrecEq{u}{v}
   &\triangleq
    \PrecEq{\Sig{u}}{\Sig{v}}\\
     &\mathrel\land
      \SubsetEq{\Types{u}}{\Types{v}}\\
       &\mathrel\land
        \forall\Member{A}{\Types{u}}.\ \SubsetEq{\WitnessesOf{u}{A}}{\WitnessesOf{v}{A}}
\end{align*}

\begin{thm}
  $\Pair{\Worlds}{\preceq}$ is a Kripke frame.
\end{thm}
\begin{proof}
  It suffices to show that $\preceq$ is reflexive and transitive, which is immediate from the corresponding properties of signature subsumption and subsethood.
\end{proof}

\subsection{Operational Semantics}

We begin with an intensional (i.e.\ world-indexed) operational semantics for
the fragment of type theory which is characterized by the signature
$\SigTT$:

\begin{gather*}
  \TyVoid:()\\
  \TyUnit:(), \Ax:()\\
  \Pi : (0,1), \lambda : (1), \mathsf{ap} : (0,0)\\
  \Sigma : (0,1), \Pair{-}{-} : (0,0), \mathsf{spread} : (0,2)\\
  \OpRequire : (0,1)
\end{gather*}

Let the judgment $\Eval{\alpha}{M}{M'}$ be pronounced ``The value of $M$ is
$M'$ under choice sequence $\alpha$.'' Then, we will explain its meaning with
respect to any world $w\in\Worlds$ such that $\SuccEq{\Sig{w}}{\SigTT}$.

The canonical forms all evaluate to themselves; the non-canonical operators
evaluate in the following way:

\begin{gather*}
  \infer{
    \Force{w}{\Eval{\alpha}{\Ap{M}{N}}{E'}}
  }{
    \Force{w}{\Eval{\alpha}{M}{\Lam{x}{E}}} &
    \Force{w}{\Eval{\alpha}{[N/x]E}{E'}}
  }\\[6pt]
  \infer{
    \Force{w}{\Eval{\alpha}{\Spread{M}{u}{v}{E}}{E'}}
  }{
    \Force{w}{\Eval{\alpha}{M}{\Pair{M_1}{M_2}}} &
    \Force{w}{\Eval{\alpha}{[M_1/u, M_2/v]E}{E'}}
  }\\[6pt]
  \infer{
    \Force{w}{\Eval{\alpha}{\Require{A}{x}{N}}{N'}}
  }{
    \IMode{\Witnesses{w}}\ni_\IMode{\mathsf{hd}(\alpha)}\OMode{M} &
    \Eval{\mathsf{tl}(\alpha)}{[M/x]N}{N'}
  }
\end{gather*}

The type system is defined by mutual recursion with the world-wellformedness
judgment, $\Force{w}{\IsWorld{u}{\alpha}}$ (presupposing $\SuccEq{u}{w}$):

\begin{gather*}
  \infer{
    \Force{w}{\IsWorld{u}{\alpha}}
  }{
    \Match{\Types{u}\setminus\Types{w}}{\SetLit{}}
  }\\[6pt]
  \infer{
    \Force{w}{\IsWorld{u}{\alpha}}
  }{
    \Match{\Types{u}\setminus\Types{w}}{\dots, B} &
    \forall\Member{M}{\Ext{\Witnesses{u}B}}.\ \Force{w}{\IsExp{\alpha}{B}{M}{M}} &
    \Force{w}{\IsWorld{\MkWorld{\Sig{u}}{\Types{u}\setminus\SetLit{B}}{\Witnesses{u}}}{\alpha}}
  }\\[6pt]
  \infer{
    \Force{w}{\IsVal{\alpha}{\TyUnit}{\Ax}{\Ax}}
  }{
  }\\[6pt]
  \infer{
    \Force{w}{\IsVal{\alpha}{\TyDFun{A}{x}{B}}{\Lam{x}{E}}{\Lam{y}{F}}}
  }{
    \begin{array}{l}
      \forall\SuccEq{u}{w}.\ \forall\Member{M,N}{\Dom{u}}.\\
      \Force{w}{\IsWorld{u}{\alpha}} \mathrel\land
      \Force{u}{\IsExpStar{\alpha}{A}{M}{N}} \Rightarrow
      \Force{u}{\IsExpStar{\alpha}{[M/x]B}{[M/x]E}{[N/y]F}}
    \end{array}
  }\\[6pt]
  \infer{
    \Force{w}{\IsVal{\alpha}{\TyDProd{A}{x}{B}}{\Pair{M}{N}}{\Pair{M'}{N'}}}
  }{
    \Force{w}{\IsExpStar{\alpha}{A}{M}{M'}} &
    \Force{w}{\IsExpStar{\alpha}{[M/x]B}{N}{N'}}
  }\\[6pt]
  \infer{
    \Force{w}{\IsExp{\alpha}{A}{M}{N}}
  }{
    \Force{w}{\Eval{\alpha}{M}{M'}} &
    \Force{w}{\Eval{\alpha}{N}{N'}} &
    \Force{w}{\IsVal{\alpha}{A}{M'}{N'}}
  }\\[6pt]
  \infer{
    \Force{w}{\IsExpStar{\alpha}{A}{M}{N}}
  }{
    \Force{w}{\Eval{\alpha}{A}{A'}} &
    \Force{w}{\IsExp{\alpha}{A'}{M}{N}}
  }
\end{gather*}

\end{document}
